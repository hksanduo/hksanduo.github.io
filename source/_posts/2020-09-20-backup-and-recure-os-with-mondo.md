---
title: "使用mondo备份恢复Linux操作系统"
date:   2020-09-20  09:30:00 +0800
layout: post
tag:
- backup
categories:
- OS
- Linux
---

使用mondo备份恢复Linux操作系统

-------
## 背景
首先先吐槽一下某大行运维人员，能力太弱，还不停的指责厂商为何不给提供的linux系统中安装图形操作界面，一个linux运维，不会配置网络，不会使用正则筛选，不会使用vim等等，整个过程中一副小人得志的嘴脸，让人感到恶心。我就不明白，一个菜鸡，就因为自己是甲方就可以随意指责乙方人员。拿钱干活，给钱走人，不想让我们来，早点儿说，无端指责，无法掩盖你的弱鸡，哈哈哈哈哈哈。     
某行使用的vsphere虚拟套件，我们提前讲操作系统和应用系统配置加固完成打包成vof模板，方便客户导入到测试poc系统，客户机房在珠海，十几个G的模板文件传输相当长的时间，后期部署，不允许厂商部署，客户要自行部署，我们也同意了。客户导入过程中，长时间未相应，最终显示超时，厂商想查看一下具体问题，判断一下问题的原因，被行方拒绝了，只告诉我们导入不进去，我也是醉了。后来被逼无奈，只能临时构建环境，移除磁盘加密等加固方式，使用monod备份系统，难受的一匹

## 安装mondo环境
在centos7中安装mondo
```
yum install -y wget
cd /etc/yum.repos.d/
wget ftp://ftp.mondorescue.org/rhel/7/x86_64/mondorescue.repo
yum clean all
yum update
yum install -y mondo --nogpgcheck
```

配置 /etc/mindi/mindi.conf 更改挂载的容量加入 **EXTRA_SPACE=8388608** 这里单位是kb 大小是8G （1024*1024*8）后边如果是制作DVD ISO文件，其实4.4G就够用了，如果备份的系统比较大，这里暂时多设置一些，要不出现问题再修改，就会很浪费时间。

## 制作iso文件
网上说的，只能刻盘，不能做U盘启动运行，未验证。执行以下指令，启动mondo 
```
# mondoarchive
```
选择磁盘
![20200920-01](/images/20200920-01.png)
设定镜像存储目录
![20200920-02](/images/20200920-02.png)
选择压缩方式
![20200920-03](/images/20200920-03.png)
选择压缩级别
![20200920-04](/images/20200920-04.png)
配置镜像大小，这里默认就行
![20200920-05](/images/20200920-05.png)
设置镜像名称
![20200920-06](/images/20200920-06.png)
设置备份目录
![20200920-07](/images/20200920-07.png)
配置备份黑名单，默认/tmp,/proc不备份
![20200920-08](/images/20200920-08.png)
设置临时缓冲目录，默认就行
![20200920-09](/images/20200920-09.png)
配置Scratch目录名称
![20200920-10](/images/20200920-10.png)
判断是否备份扩展属性
![20200920-11](/images/20200920-11.png)
配置内核路径，默认即可
![20200920-12](/images/20200920-12.png)
是否进行备份
![20200920-13](/images/20200920-13.png)
是否开始备份
![20200920-14](/images/20200920-14.png)
然后自动进行备份，等着就可以了
![20200920-15](/images/20200920-15.png)
![20200920-16](/images/20200920-16.png)
![20200920-18](/images/20200920-18.png)
备份完成，点击回车，结束
![20200920-19](/images/20200920-19.png)
![20200920-20](/images/20200920-20.png)
在```/var/cache/mondo/```目录下，我们可以看到我们备份的镜像文件，可以使用sftp,ftp等方式，下载到本地。
![20200920-21](/images/20200920-21.png)

## 还原
新建虚拟机，加载导出的镜像文件
![20200920-22](/images/20200920-22.png)
启动，进入mondo恢复引导界面
![20200920-23](/images/20200920-23.png)
输入nuke指令，回车进行系统还原，然后就耐性等待吧
![20200920-24](/images/20200920-24.png)
![20200920-25](/images/20200920-25.png)
系统提示备份完成，点击回车，输入```reboot```进行重启即可
![20200920-26](/images/20200920-26.png)
![20200920-27](/images/20200920-27.png)
![20200920-28](/images/20200920-28.png)

## 参考
- [https://www.howtoing.com/how-to-clone-linux-systems](https://www.howtoing.com/how-to-clone-linux-systems)【如何克隆/备份Linux系统使用 - Mondo Rescue灾难恢复工具】